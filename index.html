<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>catprinter</title>
    <meta name="description" content="Webapp for the MXW01 model of thermal printer.">
    <meta name="keywords" content="MXW01, catprinter, cat printer, thermal printer, receipt printer, bluetooth printer, MXW01 printer, portable printer, aliexpress printer, thermal receipt printer, mini printer, pocket printer, wireless printer, cute printer, small printer">
    <meta name="author" content="MXW01 Tools">
    <meta name="google-site-verification" content="48f-bTXCryRqg-w3Hjgpl13aBiEh2J2LXBfF4gv8xp4" />
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://mcunhal.github.io/catprinter/">
    <meta property="og:title" content="catprinter">
    <meta property="og:description" content="Webapp for the MXW01 model of thermal printer.">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://mcunhal.github.io/catprinter/">
    <meta property="twitter:title" content="catprinter">
    <meta property="twitter:description" content="Webapp for the MXW01 model of thermal printer.">
    
    <link rel="icon" type="image/png" href="/img/favicon/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="/img/favicon/favicon.svg" />
    <link rel="shortcut icon" href="/img/favicon/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/img/favicon/apple-touch-icon.png" />
    <meta name="apple-mobile-web-app-title" content="catprinter" />
    <link rel="manifest" href="/img/favicon/site.webmanifest" />
    
    <link rel="stylesheet" href="css/style.css">

    <!-- Quill WYSIWYG Editor -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>

    <!-- html2canvas for converting HTML to Canvas -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>
    <header>
        <h1>catprinter</h1>
        <p>Webapp for the MXW01 model of thermal printer.</p>
        
        <!-- Mode Toggle -->
        <div class="mode-toggle" role="tablist" aria-label="Print Modes">
            <button id="textModeBtn" class="mode-btn mode-receipt active" role="tab" aria-selected="true" aria-controls="textModeContent">Text Mode</button>
            <button id="imageModeBtn" class="mode-btn mode-image" role="tab" aria-selected="false" aria-controls="imageModeContent">Image Mode</button>
        </div>
    </header>

    <main>
        <div class="panels">
            <!-- Text/Receipt Mode Content -->
            <div id="textModeContent" class="mode-content active" role="tabpanel" aria-labelledby="textModeBtn" tabindex="0">
                <!-- Left Panel: Editor -->
                <section class="config-panel" style="display: flex; flex-direction: column;">
                    <div class="config-section">
                        <h3>Printer Settings</h3>
                        <div class="input-group">
                            <label for="printDensity">Print Density (Intensity)</label>
                            <input type="range" id="printDensity" min="0" max="255" value="93">
                            <span id="printDensityDisplay">93 (0x5D)</span>
                        </div>
                        <div class="input-group">
                            <label for="paddingVertical">Vertical Padding (mm)</label>
                            <input type="number" id="paddingVertical" min="0" max="50" value="5">
                        </div>
                        <div class="input-group">
                            <label for="paddingHorizontal">Horizontal Padding (mm)</label>
                            <input type="number" id="paddingHorizontal" min="0" max="50" value="2">
                        </div>
                    </div>

                    <div class="config-section">
                        <h3>Editor Controls</h3>
                        <div class="input-group">
                            <label for="customFontSize">Custom Font Size (px)</label>
                            <div class="flex-row">
                                <input type="number" id="customFontSize" min="8" max="200" value="16" placeholder="px">
                                <button id="applyFontSizeBtn">Apply</button>
                            </div>
                        </div>
                    </div>

                    <div id="editor-container" style="flex: 1; display: flex; flex-direction: column; min-height: 0;">
                        <div id="editor"></div>
                    </div>
                    
                    <div class="action-buttons" style="margin-top: 1rem;">
                        <button id="resetBtn" class="btn-secondary">Clear</button>
                        <button id="connectTextBtn" class="btn btn-primary connect-btn">Connect Printer</button>
                        <button id="printTextBtn" class="btn-primary" disabled>Print</button>
                    </div>
                </section>

                <!-- Right Panel: Print Preview -->
                <section class="preview-panel">
                    <div class="preview-header">
                        <h2>Print Preview</h2>
                    </div>
                    
                    <div class="preview-wrapper">
                        <div class="preview-container" id="textPreviewContainer">
                            <div id="textPreview">
                                <!-- Rendered canvas will be placed here -->
                            </div>
                        </div>
                        <div style="font-size: 0.8em; color: #666; margin-top: 5px; text-align: center;">
                            Preview simulates 384px width
                        </div>
                    </div>
                </section>
            </div>
            
            <!-- Image Mode Content -->
            <div id="imageModeContent" class="mode-content" role="tabpanel" aria-labelledby="imageModeBtn" tabindex="0">
                <!-- Left Panel: Image Configuration -->
                <section class="config-panel image-config-panel">
                    <div class="config-section">
                        <h3>Image Source</h3>
                        <div class="input-group">
                            <label for="imageUpload">Upload Image</label>
                            <div class="file-upload-container">
                                <input type="file" id="imageUpload" accept="image/*">
                            </div>
                        </div>
                        <div class="input-group">
                            <label>Rotation</label>
                            <div class="rotation-controls">
                                <button id="rotateLeftBtn" class="btn-icon" title="Rotate Left (90Â° Counter-Clockwise)" aria-label="Rotate Left 90 degrees">
                                    <span class="rotation-icon">â†º</span>
                                </button>
                                <span id="rotationDisplay">0Â°</span>
                                <button id="rotateRightBtn" class="btn-icon" title="Rotate Right (90Â° Clockwise)" aria-label="Rotate Right 90 degrees">
                                    <span class="rotation-icon">â†»</span>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="config-section">
                        <h3>Image Processing</h3>
                        <div class="input-group">
                            <label for="ditherMethod">Dithering Method</label>
                            <select id="ditherMethod">
                                <option value="threshold">Threshold</option>
                                <option value="floydSteinberg" selected>Floyd-Steinberg</option>
                                <option value="atkinson">Atkinson</option>
                                <option value="halftone">Halftone</option>
                                <option value="none">None</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label for="thresholdValue">Threshold</label>
                            <input type="range" id="thresholdValue" min="0" max="255" value="128">
                            <span id="thresholdDisplay">128</span>
                        </div>
                        <div class="input-group">
                            <label for="imageInvert">Invert Image</label>
                            <input type="checkbox" id="imageInvert">
                        </div>
                    </div>
                    
                    <div class="config-section">
                        <h3>Size & Positioning</h3>
                        <div class="input-group">
                            <label for="imageWidth">Width (px)</label>
                            <input type="number" id="imageWidth" value="384" min="1" max="384" step="1">
                        </div>
                        <div class="input-group">
                            <label for="autoscaleImage">Auto Scale to Width</label>
                            <input type="checkbox" id="autoscaleImage" checked>
                        </div>
                        <div class="input-group">
                            <label for="imagePadding">Padding (px)</label>
                            <input type="number" id="imagePadding" value="10" min="0" max="100" step="1">
                        </div>
                    </div>
                    
                    <div class="action-buttons">
                        <button id="resetImageBtn" class="btn-secondary">Reset</button>
                        <button id="connectImageBtn" class="btn btn-primary connect-btn">Connect Printer</button>
                        <button id="printImageBtn" class="btn-primary" disabled>Print</button>
                    </div>
                </section>

                <!-- Right Panel: Image Preview -->
                <section class="preview-panel image-preview-panel">
                    <div class="preview-header">
                        <h2>Print Preview</h2>
                    </div>
                    
                    <div class="image-wrapper" id="dropZone" tabindex="0" role="button" aria-label="Upload image drop zone. Click or drag image here.">
                        <div class="image-container" id="imageContainer">
                            <canvas id="imagePreview"></canvas>
                            <div id="imagePreviewMessage">Drop image here or click the upload button</div>
                        </div>
                        <div class="image-summary" id="imageSummary">
                            <!-- Image info will be placed here -->
                        </div>
                    </div>
                </section>
            </div>

            <!-- Printer Log Panel (shared between modes) -->
            <section class="log-panel">
                <div class="log-controls">
                    <h2>Printer Log</h2>
                    <div style="display: flex; gap: 0.5rem;">
                        <button id="copyLogBtn" title="Copy logs to clipboard" aria-label="Copy logs to clipboard">Copy Log</button>
                        <button id="clearLogBtn">Clear Log</button>
                    </div>
                </div>
                
                <div class="log-wrapper" id="logWrapper">
                    <!-- Log entries will be added here -->
                </div>
                
                <div class="progress-container" id="printProgress">
                    <div class="progress-bar" id="printProgressBar"></div>
                </div>
            </section>
        </div>
    </main>

    <footer>
        <p><a href="https://github.com/dropalltables/catprinter" target="_blank">catprinter</a></p>
        <div class="battery-indicator" id="batteryIndicator">
            <span class="battery-icon">ðŸ”‹</span>
            <span class="battery-level" id="batteryLevel">--</span>
        </div>
    </footer>

    <script type="module" src="js/main.js"></script>
    
    <!-- Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "SoftwareApplication",
      "name": "MXW01 CatPrinter Tools",
      "description": "Webapp for the MXW01 model of thermal printer.",
      "url": "https://mcunhal.github.io/catprinter/",
      "applicationCategory": "UtilityApplication",
      "operatingSystem": "Web Browser",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      },
      "keywords": "MXW01, catprinter, cat printer, thermal printer, receipt printer, bluetooth printer, portable printer",
      "author": {
        "@type": "Organization",
        "name": "MXW01 Tools"
      },
      "compatibleWith": [
        "MXW01 Thermal Printer",
        "CatPrinter",
        "Bluetooth Thermal Printer"
      ]
    }
    </script>
</body>
</html>
